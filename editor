<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor - LAN Apps Studio</title>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --editor-bg: #1e1e1e;
            --header-bg: #252526;
            --border-color: #3c3c3c;
            --accent: #ffd966;
            --text-gray: #cccccc;
        }

        body, html {
            margin: 0; padding: 0; height: 100%;
            background-color: var(--editor-bg);
            font-family: 'Noto Sans TC', sans-serif;
            overflow: hidden;
        }

        /* --- é™åˆ¶å±¤ç´šæ¨£å¼ --- */
        #auth-overlay, #mobile-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(18, 18, 18, 0.98);
            display: none; flex-direction: column;
            justify-content: center; align-items: center;
            z-index: 10000; text-align: center;
        }

        /* --- ç·¨è¼¯å™¨ç‰ˆé¢ --- */
        .workspace {
            display: flex;
            height: calc(100vh - 60px); /* æ‰£é™¤ navbar é«˜åº¦ */
            margin-top: 60px;
        }

        .editor-pane, .preview-pane {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 300px;
        }

        .pane-header {
            background-color: var(--header-bg);
            color: var(--text-gray);
            padding: 8px 15px;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* --- ä»£ç¢¼è¼¸å…¥æ¡† --- */
        #code-input {
            flex: 1;
            background-color: var(--editor-bg);
            color: #d4d4d4;
            border: none;
            padding: 20px;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 15px;
            outline: none;
            resize: none;
            line-height: 1.6;
            border-right: 1px solid var(--border-color);
        }

        /* --- é è¦½å€åŸŸ --- */
        #preview-iframe {
            flex: 1;
            background-color: white;
            border: none;
        }

        .status-bar {
            background: #007acc;
            color: white;
            padding: 2px 10px;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
        }

        .btn-action {
            background: transparent;
            border: 1px solid var(--accent);
            color: var(--accent);
            padding: 3px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: 0.2s;
        }

        .btn-action:hover {
            background: var(--accent);
            color: #000;
        }
    </style>
</head>
<body>

    <div id="auth-overlay">
        <h1 style="color: var(--accent);">ğŸ”’ æœƒå“¡å°ˆå±¬å·¥å…·</h1>
        <p style="color: white;">æœ¬å·¥å…·åƒ…é–‹æ”¾çµ¦è¨»å†Šæœƒå“¡ä½¿ç”¨ï¼Œè«‹å…ˆç™»å…¥ã€‚</p>
    </div>

    <div id="mobile-overlay">
        <h1 style="color: #ff4d4d;">ğŸ’» åƒ…æ”¯æ´é›»è…¦ç‰ˆ</h1>
        <p style="color: white;">ç‚ºäº†ç¢ºä¿ä»£ç¢¼ç·¨è¼¯é«”é©—ï¼Œè«‹ä½¿ç”¨é›»è…¦ç€è¦½å™¨é–‹å•Ÿæ­¤é é¢ã€‚</p>
    </div>

    <main class="workspace">
        <section class="editor-pane">
            <div class="pane-header">
                index.html
                <button class="btn-action" onclick="downloadCode()">ä¸‹è¼‰æª”æ¡ˆ</button>
            </div>
            <textarea id="code-input" spellcheck="false" placeholder="è«‹åœ¨æ­¤è¼¸å…¥ä»£ç¢¼..."></textarea>
            <div class="status-bar">
                <span>UTF-8</span>
                <span>HTML/CSS/JS Mode</span>
            </div>
        </section>

        <section class="preview-pane">
            <div class="pane-header">Live Preview</div>
            <iframe id="preview-iframe"></iframe>
        </section>
    </main>

    <script type="module" src="navbar.js"></script>

    <script type="module">
        import { auth } from './navbar.js';
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const codeInput = document.getElementById('code-input');
        const previewIframe = document.getElementById('preview-iframe');

        // é è¨­ä»£ç¢¼å…§å®¹
        const defaultCode = `<!DOCTYPE html>
<html>
<head>
  <style>
    body { background: #f4f4f9; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; font-family: sans-serif; }
    .card { background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); text-align: center; }
    h1 { color: #4285f4; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Hello World!</h1>
    <p>é€™æ˜¯åœ¨ LAN Apps Editor ç·¨è¼¯çš„çµæœ</p>
  </div>
</body>
</html>`;

        // 1. åµæ¸¬è£ç½®
        function checkDevice() {
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 1024;
            if (isMobile) {
                document.getElementById('mobile-overlay').style.display = 'flex';
                return false;
            }
            return true;
        }

        // 2. å³æ™‚æ›´æ–°é è¦½
        function updatePreview() {
            const code = codeInput.value;
            previewIframe.srcdoc = code;
            localStorage.setItem('lan-editor-content', code); // è‡ªå‹•å„²å­˜è‰ç¨¿
        }

        // 3. æª¢æŸ¥ç™»å…¥ç‹€æ…‹
        onAuthStateChanged(auth, (user) => {
            if (user && checkDevice()) {
                document.getElementById('auth-overlay').style.display = 'none';
                
                // è®€å–æš«å­˜æˆ–é è¨­ä»£ç¢¼
                const savedCode = localStorage.getItem('lan-editor-content');
                codeInput.value = savedCode || defaultCode;
                updatePreview();
            } else if (!user) {
                document.getElementById('auth-overlay').style.display = 'flex';
            }
        });

        // 4. ä¸‹è¼‰åŠŸèƒ½
        window.downloadCode = function() {
            const blob = new Blob([codeInput.value], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'my-project.html';
            a.click();
            URL.revokeObjectURL(url);
        };

        // ç›£è½è¼¸å…¥
        codeInput.addEventListener('input', updatePreview);
        window.addEventListener('resize', checkDevice);
    </script>
</body>
</html>
