<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor - LAN Studio</title>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --editor-bg: #1e1e1e;
            --header-bg: #252526;
            --border-color: #3c3c3c;
            --accent: #ffd966;
            --text-gray: #cccccc;
        }

        body, html {
            margin: 0; padding: 0; height: 100%;
            background-color: var(--editor-bg);
            font-family: 'Noto Sans TC', sans-serif;
            overflow: hidden;
        }

        /* --- é®ç½©æ¨£å¼ --- */
        #auth-overlay, #mobile-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(18, 18, 18, 0.95);
            display: none; flex-direction: column;
            justify-content: center; align-items: center;
            z-index: 10000; text-align: center;
            backdrop-filter: blur(5px);
        }

        .overlay-card {
            background: #2d2d2d;
            padding: 40px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        /* --- ç·¨è¼¯å™¨ä¸»é«” --- */
        .workspace {
            display: flex;
            height: calc(100vh - 60px);
            margin-top: 60px;
        }

        .editor-pane, .preview-pane {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 300px;
        }

        .pane-header {
            background-color: var(--header-bg);
            color: var(--text-gray);
            padding: 8px 15px;
            font-size: 13px;
            border-bottom: 1px solid var(--border-color);
            display: flex; justify-content: space-between; align-items: center;
        }

        #code-input {
            flex: 1;
            background-color: var(--editor-bg);
            color: #d4d4d4;
            border: none;
            padding: 20px;
            font-family: 'Fira Code', monospace;
            font-size: 15px;
            outline: none; resize: none; line-height: 1.6;
            border-right: 1px solid var(--border-color);
        }

        #preview-iframe { flex: 1; background-color: white; border: none; }

        .btn-action {
            background: transparent; border: 1px solid var(--accent);
            color: var(--accent); padding: 4px 12px; border-radius: 4px;
            cursor: pointer; font-size: 12px; transition: 0.2s;
        }

        .btn-action:hover { background: var(--accent); color: #000; }

        /* ç¹¼çºŒä½¿ç”¨æŒ‰éˆ• */
        .btn-continue {
            margin-top: 20px;
            background: #444;
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }

        .btn-continue:hover { background: #555; transform: translateY(-2px); }
    </style>
</head>
<body>

    <div id="auth-overlay">
        <div class="overlay-card">
            <h1 style="color: var(--accent); margin-bottom: 10px;">ğŸ”’ æ‚¨å°šæœªç™»å…¥æœƒå“¡</h1>
            <p style="color: #ff4d4d; font-weight: bold; margin-bottom: 5px;">ç„¡æ³•å„²å­˜æª”æ¡ˆè‡³ç¶²è·¯</p>
            <p style="color: #aaa; font-size: 0.9rem;">ç™»å…¥å¾Œå³å¯äº«å—é›²ç«¯å­˜æª”èˆ‡æ›´å¤šå°ˆå±¬åŠŸèƒ½ã€‚</p>
            <button class="btn-continue" onclick="dismissOverlay()">æˆ‘å·²äº†è§£ï¼Œä»è¦ä½¿ç”¨</button>
        </div>
    </div>

    <div id="mobile-overlay">
        <div class="overlay-card">
            <h1 style="color: #ff4d4d;">ğŸ’» åƒ…æ”¯æ´é›»è…¦ç‰ˆ</h1>
            <p style="color: white;">ç‚ºäº†ç¢ºä¿ä»£ç¢¼ç·¨è¼¯é«”é©—ï¼Œè«‹ä½¿ç”¨é›»è…¦ç€è¦½å™¨é–‹å•Ÿã€‚</p>
        </div>
    </div>

    <main class="workspace">
        <section class="editor-pane">
            <div class="pane-header">
                index.html
                <button class="btn-action" onclick="downloadCode()">ä¸‹è¼‰æœ¬åœ°æª”æ¡ˆ (.html)</button>
            </div>
            <textarea id="code-input" spellcheck="false"></textarea>
        </section>

        <section class="preview-pane">
            <div class="pane-header">å³æ™‚é è¦½ (Live View)</div>
            <iframe id="preview-iframe"></iframe>
        </section>
    </main>

    <script type="module" src="navbar.js"></script>

    <script type="module">
        import { auth } from './navbar.js';
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const codeInput = document.getElementById('code-input');
        const previewIframe = document.getElementById('preview-iframe');
        const authOverlay = document.getElementById('auth-overlay');

        const defaultCode = `<!DOCTYPE html>\n<html>\n<head>\n  <style>\n    body { font-family: sans-serif; text-align: center; padding-top: 50px; }\n  </style>\n</head>\n<body>\n  <h1>æ­¡è¿ä½¿ç”¨ LAN Editor</h1>\n  <p>è«‹é–‹å§‹ç·¨è¼¯...</p>\n</body>\n</html>`;

        // æ‰‹å‹•é—œé–‰é®ç½©
        window.dismissOverlay = function() {
            authOverlay.style.display = 'none';
        };

        function checkDevice() {
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 1024;
            document.getElementById('mobile-overlay').style.display = isMobile ? 'flex' : 'none';
            return !isMobile;
        }

        function updatePreview() {
            previewIframe.srcdoc = codeInput.value;
            localStorage.setItem('lan-editor-temp', codeInput.value);
        }

        onAuthStateChanged(auth, (user) => {
            if (checkDevice()) {
                // å¦‚æœå·²ç™»å…¥ï¼Œç›´æ¥éš±è—é®ç½©ï¼›æœªç™»å…¥å‰‡é¡¯ç¤º
                authOverlay.style.display = user ? 'none' : 'flex';
                
                const saved = localStorage.getItem('lan-editor-temp');
                codeInput.value = saved || defaultCode;
                updatePreview();
            }
        });

        window.downloadCode = function() {
            const blob = new Blob([codeInput.value], { type: 'text/html' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'index.html';
            a.click();
        };

        codeInput.addEventListener('input', updatePreview);
        window.addEventListener('resize', checkDevice);
    </script>
</body>
</html>